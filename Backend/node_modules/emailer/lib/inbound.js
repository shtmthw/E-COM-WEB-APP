var structr = require("structr"),
vine = require("vine"),
EventEmitter = require("events").EventEmitter,
transports = require("./transports");

module.exports = structr(EventEmitter, {

	/**
	 */

	"__construct": function(emailer) {
		this.emailer = emailer;
	},

	/**
	 */

	"handleRequest": function(req, res) {
		var command = req.params("command"),
		service = req.params("service");


		if(!command || !server) res.send(vine.error("command or service missing").data);

		var transport = transports.getTransportClass(service);

		if(!transport) res.send(vine.error("transport does not exist").data);

		if(!this.emit(command, transport.transformInboundMessage(req))) {
			return res.send(vine.error("command does not exist").data);
		}

		res.end(vine.result(true).data);
	}
});